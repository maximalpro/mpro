<h1>Начинаем работать с memcached и разгружаем БД</h1>
Если Ваша БД перегружена запросами и Вы решили ускорить работу с помощью кэширования запросов – memcache – лучший выбор.<br>
Итак давайте разберемся что такое memcache – это универсальная система распределения кэшированных элементов. Если в кэше ничего нет, то делается запрос к базе и результаты записываются в Memcache.<br>

<h2>Устанавливаем сервер Memcached на Debian/Ubuntu</h2>

Как всегда обновляем репозиторий для начала
<pre><code>#apt-get update && apt-get upgrade</code></pre>

Установим из репозитория сам memcached и модуль для php
<pre><code>#apt-get install memcached php5-memcached</code></pre>

Для начала, отредактируем конфиг, с помощью моего любимого редактора nano

<pre><code>#nano /etc/memcached.conf</code></pre>

Далее собственно напишем конфиг

<pre><code>#Memcached будет работать, как демон
-d
#Журнал событий будет складыватся здесь
logfile /var/log/memcached.log
#Отведём 256 мегабайт оперативки для хранения данных(если ОЗУ немного на машине то выделяем поменьше)
-m 256
#Выделим стандартный порт для прослушки
-p 11211
#процес от имени пользователя nobody (дальше смените лучше)
-u nobody
#Ну и слушаем localhost
-l 127.0.0.1</code></pre>


Перезапустим memcached и apache2

<pre><code># /etc/init.d/memcached restart
# /etc/init.d/apache2 restart</code></pre>

Проверим работает ли он
<pre><code># netstat -tap | grep memcached</code></pre>

Должен выдать следующее
<pre><code>tcp    0   0 localhost:11211     *:*           LISTEN   13036/memcached</code></pre>

Установка завершена, теперь на странице phpinfo() ищем раздел memcached, и если он и там есть то всё ok!

<h2>Пользуемся memcached</h2>

<br>
Memcache предоставляет много функций:<br>
<br>
<b>get()</b> – извлекает значение по ключу<br>
<b>set()</b> – устанавливает значение<br>
<b>add()</b> – добавляет кэш, если его не существует<br>
<b>replace()</b> – заменяет кэш<br>
<b>flush()</b> – удаляет все закэшированные данные<br>
<br>
Есть мнение, что много кэша это плохо. Но по моему мнению, чем быстрее грузится ваш сайт – тем лучше!<br>

<h2>Пример простого кода</h2>

Подключаемся к Memcache.

<pre><code>$m = new Memcached();
$m->addServer('127.0.0.1', 11211) or die ("Could not connect");</code></pre>

Потом создаём ключ. <br>
Чтобы поместить данные в Memcache, нам необходимо передать 3 элемента для вставки: ключ, значение и время жизни кэша.<br>
Ключ необходим для получения доступа к данным.<br>
В этом примере я использую в качестве ключа MD5 хэш запроса, но не советую использовать его для проекта, так как md5 тяжелая функция.<br>
Проверяем существует ли кэш. Проверка вернёт нам true или false.<br>
Если он есть, получаем к нему доступ, и выводим надпись, что мы получили всё из кэша.

<pre><code>$sql="SELECT * FROM `table1` WHERE `name` = 'Иван'";
$key = md5($sql);
$info = $m->get($key);

if ($info) 
{
	echo "Инфу мы достали из кэша!";
}</code></pre>

Если кэша нет - достаём значения из БД и пишем их в кэш.<br>
Для создания кэша используем set(), где передаём следующие аргументы:<br>
<b>$key</b> - ключ<br>
<b>$info</b> - собственно данные<br>
<b>15</b> - количество секунд которое будет жить кэш (можно указать как в секундах, но не более 30 дней) или в формате unix_time


<pre><code>else
{
	$result = mysql_query($sql);
	$info = mysql_fetch_array($result);
	$m->set($key, $info, 15);
}</code></pre>

Ну и собственно выводим результат

<pre><code>echo $info['name'];
echo $info['username'];</code></pre>

Как видите совсем немного кода - а результат может быть колосальным!<br>
<br>
Если Вы только начинаете использовать memcache то обратите внимание, что есть 2 библиотеки memcache и memcached и это разные вещи...точнее это две разные библиотеки для пользования однодним и тем-же.<br>
Я же Вам сейчас рассказал о memcache<b>D</b>, так как она более полная, и пришла на замену устаревшей и сбойной memcache, по скорости же она давно не проигрывает и даже выигрывает.
<br>
